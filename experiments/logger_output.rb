#!/usr/bin/env ruby

# This is a short demo of the logging output generated by PluginFactory's logger_callback.

BEGIN {
	require 'pathname'
	basedir = Pathname.new( __FILE__ ).dirname.parent
	libdir = basedir + 'lib'
	
	$LOAD_PATH.unshift( libdir.to_s ) unless $LOAD_PATH.include?( libdir.to_s )
}

require 'pluginfactory'
require 'logger'

class DataDriver
	include PluginFactory
	
	@logger = Logger.new( $stderr )
	@logger.level = Logger::DEBUG
	PluginFactory.logger_callback = lambda do |severity, msg|
		@logger.send(severity, msg)
	end

end

DataDriver.create( 'ringbuffer' )

# $ ruby experiments/logger_output.rb 
# D, [2008-03-19T18:16:29.861565 #70418] DEBUG -- : Loading derivative ringbuffer
# D, [2008-03-19T18:16:29.862118 #70418] DEBUG -- : Subdirs are: [""]
# D, [2008-03-19T18:16:29.862186 #70418] DEBUG -- : Path is: ["ringbufferdatadriver", "ringbufferDataDriver", "ringbuffer"]...
# D, [2008-03-19T18:16:29.862235 #70418] DEBUG -- : Trying ringbufferdatadriver...
# D, [2008-03-19T18:16:29.862383 #70418] DEBUG -- : No module at 'ringbufferdatadriver', trying the next alternative: 'no such file to load -- ringbufferdatadriver'
# D, [2008-03-19T18:16:29.862422 #70418] DEBUG -- : Trying ringbufferDataDriver...
# D, [2008-03-19T18:16:29.862546 #70418] DEBUG -- : No module at 'ringbufferDataDriver', trying the next alternative: 'no such file to load -- ringbufferDataDriver'
# D, [2008-03-19T18:16:29.862581 #70418] DEBUG -- : Trying ringbuffer...
# D, [2008-03-19T18:16:29.862707 #70418] DEBUG -- : No module at 'ringbuffer', trying the next alternative: 'no such file to load -- ringbuffer'
# D, [2008-03-19T18:16:29.862746 #70418] DEBUG -- : fatals = []
# E, [2008-03-19T18:16:29.862793 #70418] ERROR -- : Couldn't find a DataDriver named 'ringbuffer': tried ["ringbufferdatadriver", "ringbufferDataDriver", "ringbuffer"]
# ./lib/pluginfactory.rb:348:in `require_derivative': Couldn't find a DataDriver named 'ringbuffer': tried ["ringbufferdatadriver", "ringbufferDataDriver", "ringbuffer"] (FactoryError)
# 	from ./lib/pluginfactory.rb:252:in `load_derivative'
# 	from ./lib/pluginfactory.rb:220:in `get_subclass'
# 	from ./lib/pluginfactory.rb:194:in `create'
# 	from experiments/logger_output.rb:27
